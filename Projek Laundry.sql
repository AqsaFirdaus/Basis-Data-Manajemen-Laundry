#TABEL PENGGUNA
CREATE TABLE PENGGUNA (
	ID_PENGGUNA VARCHAR(5) PRIMARY KEY,
	NAMA_PENGGUNA VARCHAR(50) NOT NULL,
	NOMOR_TELEPON_PENGGUNA BIGINT NOT NULL,
	ALAMAT_PENGGUNA VARCHAR(50) NOT NULL
)

INSERT INTO PENGGUNA (ID_PENGGUNA, NAMA_PENGGUNA, NOMOR_TELEPON_PENGGUNA, ALAMAT_PENGGUNA)
VALUES 
('96360', 'JOY', '6289653145381', 'JL. KARANGREJO TIMUR 1 NO. 4'),
('34189', 'ALEXANDRA', '6281253145382', 'JL. KETINTANG BARU NO. 12'),
('51560', 'GOBEL', '6282324053881', 'JL. KETINTANG NO. 20'),
('76360', 'AQSA', '6282324053882', 'TENGGUMUNG BARU SELATAN NO. 5'),
('34190', 'ANDREAS', '6285175055180', 'JL. JERUK MANIS V NO. 40 A'),
('71098', 'FACHRI', '6282543081154', 'JL. IR. SOEKARNO NO. 42'),
('15602', 'ISHAQ', '6285439867027', 'JL. GRANTING BARU NO. 17'),
('21603', 'FAHMI', '6281267325009', 'JL. WONOSARI SELATAN NO. 21'),
('43087', 'RANGGA', '6282344678831', 'JL. KRANGGAN NO. 89'),
('61123', 'RERE', '6285443217523', 'JL. TUNJUNGAN NO. 25')

SELECT * FROM PENGGUNA



#TABEL PEMBAYARAN
CREATE TABLE PEMBAYARAN (
	ID_PEMBAYARAN BIGINT PRIMARY KEY,
	TANGGAL_PEMBAYARAN DATE NOT NULL,
	METODE_PEMBAYARAN VARCHAR(10) NOT NULL,
	STATUS_PEMBAYARAN VARCHAR(20) NOT NULL,
	ID_PEMESANAN BIGINT NOT NULL
)

INSERT INTO pembayaran (id_pembayaran, tanggal_pembayaran, metode_pembayaran, status_pembayaran, id_pemesanan)
VALUES
(963601303241, '2024-03-13', 'TRANSFER', 'SUDAH DIBAYAR', 963601303241217),
(341890204240, '2024-04-02', 'TUNAI', 'SUDAH DIBAYAR', 341890204240946),
(341890505240, '2024-05-05', 'TUNAI', 'SUDAH DIBAYAR', 341890505240947),
(525206062241, '2024-06-06', 'TRANSFER', 'SUDAH DIBAYAR', 52520606241234),
(341900707241, '2024-07-07', 'TRANSFER', 'SUDAH DIBAYAR', 341900707245678),
(963601001241, '2024-01-10', 'TUNAI', 'SUDAH DIBAYAR', 96360100124234),
(963601001245, '2024-02-15', 'TRANSFER', 'SUDAH DIBAYAR', 96360150224241),
(515602308240, '2024-08-23', 'TUNAI', 'SUDAH DIBAYAR', 51560230824367),
(710982809240, '2024-09-28', 'TRANSFER', 'SUDAH DIBAYAR', 71098280924982),
(763601017241, '2024-10-17', 'TUNAI', 'SUDAH DIBAYAR', 76360101724092);

ALTER TABLE PEMBAYARAN ADD CONSTRAINT ID_PEMESANAN FOREIGN KEY (ID_PEMESANAN)
REFERENCES PEMESANAN(ID_PEMESANAN)

SELECT * FROM PEMBAYARAN



#TABEL PEMESANAN
CREATE TABLE PEMESANAN (
	ID_PEMESANAN BIGINT PRIMARY KEY,
	TANGGAL_PEMESANAN DATE NOT NULL,
	BERAT_ITEM INTEGER NOT NULL,
	ID_PEMBAYARAN BIGINT NOT NULL,
	ID_PENGGUNA BIGINT NOT NULL,
	KATEGORI_LAYANAN VARCHAR(200) NOT NULL,
	ID_CABANG BIGINT NOT NULL,
	ID_KARYAWAN BIGINT NOT NULL
)

INSERT INTO pemesanan (id_pemesanan, tanggal_pemesanan, berat_item, id_pembayaran, id_pengguna, kategori_layanan, id_cabang, id_karyawan)
VALUES
(963601303241217, '2024-03-13', 3, 963601303241, 96360, 'CUCI SETRIKA REGULER', 3664473050, 6447305001),
(96360150224241, '2024-02-15', 5, 963601001245, 96360, 'CUCI SETRIKA REGULER', 3664473050, 6447305001),
(52520606241234, '2024-06-06', 6, 525206062241, 51560, 'CUCI SETRIKA EXPRESS', 3664473050, 6447305001),
(96360100124234, '2024-01-10', 4, 963601001241, 96360, 'CUCI SETRIKA EXPRESS', 3664473050, 6447305001),
(76360101724092, '2024-10-17', 2, 763601017241, 76360, 'CUCI SETRIKA EXPRESS', 3664473050, 6447305001),
(341890505240947, '2024-05-05', 5, 341890505240, 34189, 'CUCI KERING REGULER', 3664473050, 6447305002),
(341900707245678, '2024-07-07', 7, 341900707241, 34190, 'CUCI KERING REGULER', 3664473050, 6447305002),
(71098280924982, '2024-09-28', 6, 710982809240, 71098, 'CUCI KERING REGULER', 3664473050, 6447305002),
(341890204240946, '2024-04-02', 4, 341890204240, 34189, 'CUCI KERING EXPRESS', 3664473050, 6447305003),
(51560230824367, '2024-08-23', 3, 515602308240, 51560, 'CUCI KERING EXPRESS', 3664473050, 6447305003)

ALTER TABLE PEMESANAN ADD CONSTRAINT ID_PEMBAYARAN FOREIGN KEY (ID_PEMBAYARAN)
REFERENCES PEMBAYARAN(ID_PEMBAYARAN)

ALTER TABLE PEMESANAN ADD CONSTRAINT ID_PENGGUNA FOREIGN KEY (ID_PENGGUNA)
REFERENCES PENGGUNA(ID_PENGGUNA)

ALTER TABLE PEMESANAN ADD CONSTRAINT KATEGORI_LAYANAN FOREIGN KEY (KATEGORI_LAYANAN)
REFERENCES LAYANAN(KATEGORI_LAYANAN)

ALTER TABLE PEMESANAN ADD CONSTRAINT ID_CABANG FOREIGN KEY (ID_CABANG)
REFERENCES CABANG(ID_CABANG)

ALTER TABLE PEMESANAN ADD CONSTRAINT ID_KARYAWAN FOREIGN KEY (ID_KARYAWAN)
REFERENCES KARYAWAN(ID_KARYAWAN)

SELECT * FROM PEMESANAN



#TABEL FEEDBACK
CREATE TABLE FEEDBACK(
ID_FEEDBACK BIGINT PRIMARY KEY,
ID_PENGGUNA BIGINT NOT NULL,
ID_PEMESANAN BIGINT NOT NULL,
RATING INTEGER NOT NULL,
KOMENTAR VARCHAR (200) NOT NULL,
TANGGAL_FEEDBACK DATE NOT NULL
)

INSERT INTO  FEEDBACK (id_feedback, id_pengguna, id_pemesanan, rating, komentar, tanggal_feedback) 
VALUES
(9636013032412171, 96360, 963601303241217, 10, 'CEPAT SELESAI', '2024-03-16'),
(525206062412342, 51560, 52520606241234, 10, 'WORTH IT', '2024-06-09'),
(3418902042409463, 34189, 341890204240946, 9, 'BAUNYA WANGI', '2024-04-15'),
(3418905052409474, 34189, 341890505240947, 8, 'HASIL MEMUASKAN', '2024-05-08'),
(3419007072456785, 34190, 341900707245678, 10, 'PAKAIAN RAPI', '2024-07-10'),
(963601001242346, 96360, 96360100124234, 9, 'MURAH SEKALI', '2024-01-13'),
(963601502242417, 96360, 96360150224241, 9, 'CEPAT SEKALI', '2024-02-18'),
(515602308243678, 51560, 51560230824367, 10, 'MANTAP', '2024-08-26'),
(710982809249829, 71098, 71098280924982, 9, 'KELAZZ', '2024-09-30'),
(7636010172409210, 76360, 76360101724092, 9, '', '2024-10-20')

ALTER TABLE FEEDBACK ADD CONSTRAINT ID_PENGGUNA FOREIGN KEY (ID_PENGGUNA)
REFERENCES PENGGUNA(ID_PENGGUNA)

ALTER TABLE FEEDBACK ADD CONSTRAINT ID_PEMESANAN FOREIGN KEY (ID_PEMESANAN)
REFERENCES PEMESANAN(ID_PEMESANAN)

SELECT * FROM FEEDBACK 



#TABEL LAYANAN
CREATE TABLE LAYANAN (
KATEGORI_LAYANAN VARCHAR(200) PRIMARY KEY,
DESKRIPSI_LAYANAN VARCHAR(200) NOT NULL,
HARGA_LAYANAN INTEGER NOT NULL,
WAKTU_PROSES INTERVAL NOT NULL
)

INSERT INTO LAYANAN (kategori_layanan, deskripsi_layanan, harga_layanan, waktu_proses) 
VALUES
('CUCI SETRIKA REGULER', 'Pakaian dicuci dengan metode biasa, kemudian disetrika untuk hasil yang rapi.', 6000, '3 days'),
('CUCI KERING REGULER', 'Proses pencucian pakaian menggunakan metode kering tanpa pembasahan penuh, dilakukan secara normal atau reguler', 4000, '2 days'),
('CUCI SETRIKA EXPRESS', 'Kombinasi layanan cuci dan setrika dengan pengerjaan cepat.', 8000, '2 days'),
('CUCI KERING EXPRESS', 'Layanan pencucian kering yang lebih cepat dibandingkan dengan kategori reguler.', 5000, '1 day');

SELECT * FROM LAYANAN



#TABEL SUPPLIER
CREATE TABLE SUPPLIER(
	ID_SUPPLIER BIGINT PRIMARY KEY,
	NAMA_SUPPLIER VARCHAR(50) NOT NULL,
	ALAMAT_SUPPLIER VARCHAR(100) NOT NULL,
	NOMOR_TELEPON_SUPPLIER BIGINT NOT NULL,
	JENIS_PRODUK VARCHAR(100) NOT NULL
)

INSERT INTO SUPPLIER (id_supplier, nama_supplier, alamat_supplier, nomor_telepon_supplier, jenis_produk)
VALUES
(36644730501, 'YANTOWANGI', 'JL. KETINTANG BARU NO 16', '85243907655', 'PEWANGI'),
(36644730502, 'YANTISABUN', 'JL. WIYUNG NO 20', '81245567742', 'SABUN'),
(36644730511, 'YANTOWANGI', 'JL. MERUYA NO 13', '85543216799', 'PEWANGI'),
(36644730512, 'YANTOSABUN', 'JL. JOGLO NO 15', '85543216790', 'SABUN'),
(36644730521, 'YANTOWANGI', 'JL. SUHAT NO 20', '85543216523', 'PEWANGI'),
(36644730522, 'YANTOSABUN', 'JL. LAWU NO 16', '82344567809', 'SABUN'),
(36644730531, 'YANTOWANGI', 'JL. MENCONG NO 25', '85436789021', 'PEWANGI'),
(36644730532, 'YANTOSABUN', 'JL. BINTARO NO 54', '81345675432', 'SABUN'),
(36644730541, 'YANTOWANGI', 'JL. SRIWIJAYA NO 42', '81345623388', 'PEWANGI'),
(36644730542, 'YANTOSABUN', 'JL. PATIMURA NO 40', '85677881432', 'SABUN')

SELECT * FROM SUPPLIER



#TABEL CABANG
CREATE TABLE CABANG (
	ID_CABANG BIGINT PRIMARY KEY,
	NAMA_CABANG VARCHAR(50) NOT NULL,
	ALAMAT_CABANG VARCHAR(100) NOT NULL,
	NOMOR_TELEPON_CABANG BIGINT
)

INSERT INTO CABANG (id_cabang, nama_cabang, alamat_cabang, nomor_telepon_cabang) 
VALUES
(3664473050, 'PAMAN LAUNDRY SURABAYA', 'JL KARANGREJO TIMUR 1 NO. 53 C', 895401465818),
(3664473051, 'PAMAN LAUNDRY JAKARTA BARAT', 'JL JERUK MANIS V NO. 40 A', 895401465820),
(3664473052, 'PAMAN LAUNDRY MALANG', 'JL TIRTA GANGGA NO 2', 895401465822),
(3664473053, 'PAMAN LAUNDRY TANGERANG', 'JL HJ. UMAR NO 115', 895401465824),
(3664473054, 'PAMAN LAUNDRY KEDIRI', 'JL PANDEAN NO 25', 895401465826),
(3664473055, 'PAMAN LAUNDRY BEKASI', 'JL JEMBATAN LIMA NO 10', 895401465828),
(3664473056, 'PAMAN LAUNDRY JEMBER', 'JL DIPONEGORO NO 9', 895401465830),
(3664473057, 'PAMAN LAUNDRY BLITAR', 'JL KALIBRANTAS', 895401465832),
(3664473058, 'PAMAN LAUNDRY BANDUNG', 'JL PASUNDAN NO 57', 895401465834),
(3664473059, 'PAMAN LAUNDRY YOGYAKARTA', 'JL KUSUMANEGARA NO 56', 895401465836)

SELECT * FROM CABANG 



#TABEL KARYAWAN
CREATE TABLE KARYAWAN (
	ID_KARYAWAN BIGINT PRIMARY KEY,
	NAMA_KARYAWAN VARCHAR(50) NOT NULL,
	NOMOR_TELEPON_KARYAWAN BIGINT NOT NULL,
	ID_CABANG BIGINT NOT NULL
)

INSERT INTO KARYAWAN (id_karyawan, nama_karyawan, nomor_telepon_karyawan, id_cabang) 
VALUES
(6447305001, 'SETIAWAN ADE', 85101639735, 3664473050),
(6447305002, 'AGUS MAULANA', 85387654321, 3664473050),
(6447305003, 'MAIMUNAH', 82356789101, 3664473050),
(6447305101, 'SITI AYU', 85254329876, 3664473051),
(6447305102, 'RINA KIRANA', 85264725566, 3664473051),
(6447305103, 'BAMBANG DEWANDI', 82323544471, 3664473051),
(6447305201, 'LINA DEWI', 82299872354, 3664473052),
(6447305202, 'NIA IKA', 88254452001, 3664473052),
(6447305203, 'SLAMET EKA', 81367320987, 3664473052),
(6447305301, 'NOVI MAYA', 81512215423, 3664473053)

ALTER TABLE KARYAWAN ADD CONSTRAINT ID_CABANG FOREIGN KEY (ID_CABANG)
REFERENCES CABANG(ID_CABANG)

SELECT * FROM KARYAWAN



#TABEL MENYEDIAKAN
CREATE TABLE MENYEDIAKAN(
	ID_PEMESANAN BIGINT,
	KATEGORI_LAYANAN VARCHAR(200),
	CONSTRAINT ID_PEMESANAN
		FOREIGN KEY (ID_PEMESANAN) REFERENCES PEMESANAN (ID_PEMESANAN),
	CONSTRAINT KATEGORI_LAYANAN
		FOREIGN KEY (KATEGORI_LAYANAN) REFERENCES LAYANAN (KATEGORI_LAYANAN)
)

INSERT INTO MENYEDIAKAN (ID_PEMESANAN, KATEGORI_LAYANAN)
VALUES
(963601303241217,'CUCI SETRIKA REGULER' ),
(96360150224241, 'CUCI SETRIKA REGULER'),
(52520606241234, 'CUCI SETRIKA EXPRESS'),
(96360100124234, 'CUCI SETRIKA EXPRESS'),
(76360101724092, 'CUCI SETRIKA EXPRESS'),
(341890505240947, 'CUCI KERING REGULER'),
(341900707245678, 'CUCI KERING REGULER'),
(71098280924982, 'CUCI KERING REGULER'),
(341890204240946, 'CUCI KERING EXPRESS'),
(51560230824367, 'CUCI KERING EXPRESS' )



#TABEL MEMASOK
CREATE TABLE MEMASOK(
	ID_CABANG BIGINT,
	ID_SUPPLIER BIGINT,
	CONSTRAINT FK_CABANG
		FOREIGN KEY (ID_CABANG) REFERENCES CABANG (ID_CABANG),
	CONSTRAINT FK_SUPPLIER 
		FOREIGN KEY (ID_SUPPLIER) REFERENCES SUPPLIER (ID_SUPPLIER)
)

INSERT INTO MEMASOK
VALUES
(3664473050, 36644730501),
(3664473050, 36644730502),
(3664473051, 36644730511),
(3664473051, 36644730512),
(3664473052, 36644730521),
(3664473052, 36644730522),
(3664473053, 36644730531),
(3664473053, 36644730532),
(3664473054, 36644730541),
(3664473054, 36644730542)



#TABEL DIPROSES
CREATE TABLE DIPROSES(
	ID_PEMESANAN BIGINT,
	ID_KARYAWAN BIGINT,
	CONSTRAINT FK_PEMESANAN
		FOREIGN KEY (ID_PEMESANAN) REFERENCES PEMESANAN (ID_PEMESANAN),
	CONSTRAINT FK_KARYAWAN
		FOREIGN KEY (ID_KARYAWAN) REFERENCES KARYAWAN (ID_KARYAWAN)
)

INSERT INTO DIPROSES
VALUES
(963601303241217, 6447305001),
(96360150224241, 6447305001),
(52520606241234, 6447305001),
(96360100124234, 6447305001),
(76360101724092, 6447305001),
(341890505240947, 6447305002),
(341900707245678, 6447305002),
(71098280924982, 6447305002),
(341890204240946, 6447305003),
(51560230824367, 6447305003)



#TABEL MELAKUKAN
CREATE TABLE MELAKUKAN(
	KATEGORI_LAYANAN VARCHAR(200),
	ID_KARYAWAN BIGINT,
	CONSTRAINT FK_LAYANAN
		FOREIGN KEY (KATEGORI_LAYANAN) REFERENCES LAYANAN (KATEGORI_LAYANAN),
	CONSTRAINT FK_KARYAWAN
		FOREIGN KEY (ID_KARYAWAN) REFERENCES KARYAWAN (ID_KARYAWAN)
)

INSERT INTO MELAKUKAN
VALUES
('CUCI SETRIKA REGULER', 6447305001),
('CUCI SETRIKA REGULER', 6447305001),
('CUCI SETRIKA EXPRESS', 6447305001),
('CUCI SETRIKA EXPRESS', 6447305001),
('CUCI SETRIKA EXPRESS', 6447305001),
('CUCI KERING REGULER', 6447305002),
('CUCI KERING REGULER', 6447305002),
('CUCI KERING REGULER', 6447305002),
('CUCI KERING EXPRESS', 6447305003),
('CUCI KERING EXPRESS', 6447305003)



#MENAMPILKAN LAPORAN
SELECT 
    PENGGUNA.ID_PENGGUNA,
    PENGGUNA.NAMA_PENGGUNA,
    PENGGUNA.ALAMAT_PENGGUNA,
    PENGGUNA.NOMOR_TELEPON_PENGGUNA,
    PEMESANAN.ID_PEMESANAN,
    PEMESANAN.TANGGAL_PEMESANAN,
    PEMESANAN.BERAT_ITEM,
    MENYEDIAKAN.KATEGORI_LAYANAN,
	LAYANAN.HARGA_LAYANAN,
	CABANG.ID_CABANG,
	CABANG.ALAMAT_CABANG,
	CABANG.NAMA_CABANG,
	CABANG.NOMOR_TELEPON_CABANG,
	SUM(LAYANAN.HARGA_LAYANAN * PEMESANAN.BERAT_ITEM) AS TOTAL_HARGA
FROM PENGGUNA
JOIN PEMESANAN ON PENGGUNA.ID_PENGGUNA = PEMESANAN.ID_PENGGUNA
JOIN MENYEDIAKAN ON PEMESANAN.ID_PEMESANAN = MENYEDIAKAN.ID_PEMESANAN
JOIN LAYANAN ON MENYEDIAKAN.KATEGORI_LAYANAN = LAYANAN.KATEGORI_LAYANAN
JOIN CABANG ON PEMESANAN.ID_CABANG = CABANG.ID_CABANG
GROUP BY 
    PENGGUNA.ID_PENGGUNA,
    PENGGUNA.NAMA_PENGGUNA,
    PENGGUNA.ALAMAT_PENGGUNA,
    PENGGUNA.NOMOR_TELEPON_PENGGUNA,
    PEMESANAN.ID_PEMESANAN,
    PEMESANAN.TANGGAL_PEMESANAN,
    PEMESANAN.BERAT_ITEM,
    MENYEDIAKAN.KATEGORI_LAYANAN,
	LAYANAN.HARGA_LAYANAN,
	CABANG.ID_CABANG,
	CABANG.ALAMAT_CABANG,
	CABANG.NAMA_CABANG,
	CABANG.NOMOR_TELEPON_CABANG
ORDER BY TOTAL_HARGA DESC;



#QUERY_UNTUK_STORE_PROCEDURE
CREATE OR REPLACE PROCEDURE get_laporan_harian(date_param DATE)
LANGUAGE sql
AS $$
    SELECT 
        id_pemesanan,
        id_pengguna,
        tanggal_pemesanan,
        total_harga
    FROM 
        LAPORAN_HARIAN
    WHERE 
        tanggal_pemesanan = date_param;
$$;

CALL get_laporan_harian('2024-10-17');



#QUERY_UNTUK_VIEW
CREATE VIEW LAPORAN_HARIAN AS
SELECT 
    PEMESANAN.ID_PEMESANAN,
    PEMESANAN.ID_PENGGUNA,
    DATE(PEMESANAN.TANGGAL_PEMESANAN) AS TANGGAL_PEMESANAN,
    SUM(LAYANAN.HARGA_LAYANAN * PEMESANAN.BERAT_ITEM) AS TOTAL_HARGA
FROM 
    PEMESANAN
JOIN MENYEDIAKAN ON PEMESANAN.ID_PEMESANAN = MENYEDIAKAN.ID_PEMESANAN
JOIN LAYANAN ON MENYEDIAKAN.KATEGORI_LAYANAN = LAYANAN.KATEGORI_LAYANAN
GROUP BY 
    PEMESANAN.ID_PEMESANAN,
    PEMESANAN.ID_PENGGUNA,
    DATE(PEMESANAN.TANGGAL_PEMESANAN);

SELECT * FROM LAPORAN_HARIAN WHERE TANGGAL_PEMESANAN='2024-10-17';
